﻿

# PayPulse — Complete Build & Growth Guide
*An end-to-end guide for a solo developer to build, launch, and grow PayPulse — an India-first invoice + automated payment reminder SaaS. Written in a clear, step-by-step teacher/advisor tone so you can learn and implement every piece.*

---

## Quick start (one-sentence)
**PayPulse** automates invoice reminders (WhatsApp + Email) and attaches Razorpay payment links so freelancers and small agencies in India get paid faster.

---

## How to use this document
- Read from start → you will go from concepts → code → deployment → growth.
- Use the "Step-by-step Implementation" sections to build feature-by-feature.
- Treat the "Advanced" and "AI" sections as future upgrades after MVP is live.

---

## Table of contents
1. Product overview (simple)  
2. Who this helps & why it matters  
3. MVP features (what to build first)  
4. Project name & positioning (brand)  
5. Tech stack & why it fits you  
6. Data model (Prisma) — full schema (copy-ready)  
7. Auth & multi-tenant basics — explained like a teacher  
8. API design (REST) with examples  
9. Frontend pages & UX flow (Next.js + Tailwind)  
10. Razorpay integration & webhook handling (step-by-step)  
11. Reminder engine (WhatsApp + Email) — design + implementation  
12. Jobs & Worker patterns (BullMQ + Redis)  
13. Testing, Monitoring & Logging — practical guide  
14. Deployment & CI/CD — simple routes for solo dev  
15. Security checklist — keep it safe  
16. Step-by-step implementation plan (14-day MVP + 8-week roadmap)  
17. Marketing & getting first customers (practical scripts)  
18. AI roadmap — OCR, LLMs for messaging, payment prediction  
19. Premium features & how they scale into a company  
20. Teaching/advising notes — how to learn each topic fast  
21. Checklists (copyable)  
22. Appendix (templates, sample code snippets, links)

---

## 1) Product overview (simple)
PayPulse helps you stop chasing clients manually. Upload an invoice, set due date, and PayPulse will send polite reminders by WhatsApp and Email with a Razorpay payment link. It keeps a log, shows dashboard stats, and cancels reminders once payment is made.

---

## 2) Who this helps & why it matters
- Freelancers with multiple clients who can’t track all due dates.  
- Small agencies that have dozens of invoices per month.  
- Accounts teams for SMEs who want automation and logs.  
Value: saves time, improves cashflow, reduces awkward conversations.

---

## 3) MVP features (must-have)
- Signup & tenant creation (Owner account)  
- Upload invoice PDF or attach invoice details  
- Client record (name, email, phone)  
- Create invoice with amount, due date, pdfUrl  
- Razorpay one-time payment integration (create order → checkout)  
- Razorpay webhook → mark invoice paid  
- Reminder scheduler: WhatsApp + Email messages at configurable intervals  
- Dashboard: Outstanding, Overdue, Paid lists  
- Manual "send reminder now" action

---

## 4) Project name & positioning
**PayPulse** — India-first micro-SaaS for invoice reminders and collections. Position to freelancers and agencies with tagline:
> Stop chasing payments. PayPulse reminds clients and attaches payment links so you get paid faster.

---

## 5) Tech stack & why it fits you


---

## Folder Descriptions

- **`src/auth/`** – Handles authentication and JWT strategies.  
  - `auth.module.ts` – NestJS module for auth.  
  - `auth.controller.ts` – Handles signup/login endpoints.  
  - `auth.service.ts` – Auth logic (hash passwords, JWT, tenant creation).  
  - `jwt.strategy.ts` – JWT validation logic.  
  - `guards/tenant.guard.ts` – Ensures multi-tenant access control.

- **`src/clients/`** – CRUD operations for clients per tenant.  

- **`src/invoices/`** – Invoice creation, listing, and details.  

- **`src/payments/`** – Razorpay integration, order creation, webhook handling.  

- **`src/reminders/`** – Scheduling and processing reminders via BullMQ.  
  - `reminders.worker.ts` – Background worker to send messages.  

- **`src/prisma/prisma.service.ts`** – Prisma client wrapper for NestJS.  

- **`src/app.module.ts`** – Root module, imports all feature modules.  
- **`src/main.ts`** – Application bootstrap file.  

- **`prisma/schema.prisma`** – Database schema and Prisma models.  
- **`prisma/migrations/`** – Migration files generated by Prisma.  

- **`.env`** – Environment variables (DB, JWT, Razorpay, Redis).  
- **`tsconfig.json`** – TypeScript configuration.  
- **`package.json`** – NPM dependencies and scripts.  
- **`README.md`** – Project documentation.

---


- Backend: **NestJS + TypeScript** — structured, scalable, great for hiring signals.  
- ORM: **Prisma** — easy migrations + type safety.  
- DB: **PostgreSQL (Supabase or managed)** — reliable, supports later RLS.  
- Frontend: **Next.js + Tailwind** — fast UI, SEO for landing page.  
- Jobs: **BullMQ + Redis** — background scheduling.  
- Storage: **S3 or Supabase Storage** — invoices PDF.  
- Payments: **Razorpay (India)** — UPI/UPI collect/ cards.  
- Messaging: **WhatsApp Cloud API** (Meta) / **SendGrid** for email.  
- Deployment: Vercel (frontend) + Render/Heroku/AWS (backend).

---

## 6) Data model (Prisma) — copy this file into `prisma/schema.prisma`

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Tenant {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  plan        String     @default("free")
  createdAt   DateTime   @default(now())
  users       User[]
  clients     Client[]
  invoices    Invoice[]
  settings    TenantSettings?
}

model TenantSettings {
  id                String   @id @default(cuid())
  tenantId          String   @unique
  tenant            Tenant   @relation(fields: [tenantId], references: [id])
  reminderIntervals String?  // JSON, e.g. "[ -3, 0, 3, 7 ]" days
  whatsappTemplate  String?
  emailTemplate     String?
  createdAt         DateTime @default(now())
}

model User {
  id         String    @id @default(cuid())
  tenantId   String
  tenant     Tenant    @relation(fields: [tenantId], references: [id])
  name       String?
  email      String    @unique
  password   String?
  role       UserRole  @default(OWNER)
  createdAt  DateTime  @default(now())
}

enum UserRole {
  OWNER
  ADMIN
  MEMBER
}

model Client {
  id         String     @id @default(cuid())
  tenantId   String
  tenant     Tenant     @relation(fields: [tenantId], references: [id])
  name       String
  email      String?
  phone      String?
  createdAt  DateTime   @default(now())
  invoices   Invoice[]
}

model Invoice {
  id                String       @id @default(cuid())
  tenantId          String
  tenant            Tenant       @relation(fields: [tenantId], references: [id])
  clientId          String?
  client            Client?      @relation(fields: [clientId], references: [id])
  createdById       String
  createdBy         User         @relation(fields: [createdById], references: [id])
  invoiceNumber     String       @unique
  amount            Float
  currency          String       @default("INR")
  dueDate           DateTime
  issuedDate        DateTime     @default(now())
  status            InvoiceStatus @default(PENDING)
  razorpayOrderId   String?
  razorpayPaymentId String?
  pdfUrl            String?
  notes             String?
  createdAt         DateTime     @default(now())
  reminders         Reminder[]
  payments          Payment[]
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

model Reminder {
  id         String    @id @default(cuid())
  invoiceId  String
  invoice    Invoice   @relation(fields: [invoiceId], references: [id])
  method     ReminderMethod
  scheduledAt DateTime
  sentAt     DateTime?
  status     ReminderStatus @default(PENDING)
  attempt    Int @default(0)
  createdAt  DateTime @default(now())
}

enum ReminderMethod {
  WHATSAPP
  EMAIL
  SMS
}

enum ReminderStatus {
  PENDING
  SENT
  FAILED
}

model Payment {
  id              String    @id @default(cuid())
  invoiceId       String
  invoice         Invoice   @relation(fields: [invoiceId], references: [id])
  amount          Float
  currency        String
  provider        String
  providerPaymentId String?
  status          PaymentStatus @default(PENDING)
  paidAt          DateTime?
  createdAt       DateTime @default(now())
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}
```

---

## 7) Auth & multi-tenant basics — explained simply
**What is tenant?** Tenant = one business (your client, your agency). Multi-tenant = many businesses use same app but cannot see each other's data.

**How to enforce?**
1. Add `tenantId` to all business tables.  
2. When a user signs up, create a `Tenant` and attach `tenantId` to the user.  
3. Include `tenantId` in the JWT payload.  
4. Build a TenantGuard in NestJS that reads `req.user.tenantId` and attaches it to request. Every DB query uses that `tenantId`.

**Example JWT payload:**
```json
{ "sub": "userId", "tenantId": "tenantId", "role": "OWNER" }
```

**Simple tenant guard (concept):**
- On each request, ensure user exists and has tenantId. If not, return 401.
- Do NOT accept tenantId from client data.

---

## 8) API design (REST) — minimal & useful endpoints

### Auth
- `POST /api/auth/signup` → create Tenant + User. Returns JWT.  
- `POST /api/auth/login` → returns JWT.

### Clients
- `GET /api/clients`  
- `POST /api/clients` `{ name, email?, phone? }`

### Invoices
- `GET /api/invoices`?status=PENDING  
- `GET /api/invoices/:id`  
- `POST /api/invoices` `{ clientId, amount, dueDate, pdfUrl? }`  
- `POST /api/invoices/:id/send` → enqueue immediate reminder

### Payments & Billing
- `POST /api/payments/razorpay/create-order` `{ invoiceId }` → returns order_id  
- `POST /api/webhooks/razorpay` → accepts webhook, verify, update invoice/payment

### Reminders
- `POST /api/reminders/:invoiceId/schedule` — internal  
- `GET /api/reminders` — list

---

## 9) Frontend pages & UX flow (Next.js + Tailwind)
Build these pages:
1. Landing page (marketing & pricing)  
2. Signup / Login  
3. Dashboard (cards: Outstanding, Overdue, Paid)  
4. Clients (list + create)  
5. Create Invoice (upload PDF or fill form)  
6. Invoice Detail (status, send reminder button)  
7. Billing / Upgrade page  
8. Settings (templates, team invites)

**UX tips**:
- After invoice creation show a modal "Send Reminder Now" with checkbox to open Razorpay checkout or just send link.  
- On invoice detail, show timeline of reminders sent.  
- Use optimistic UI for immediate feedback.

---

## 10) Razorpay integration (step-by-step)
**Goal:** let client pay via Razorpay + webhook updates invoice status.

1. Create an invoice in DB with amount.  
2. Backend endpoint `/payments/razorpay/create-order` calls Razorpay Orders API with amount in paise and `receipt = invoiceNumber`. Save returned `order.id` as `razorpayOrderId` on invoice.  
3. Return order details to frontend.  
4. Frontend opens Razorpay Checkout using `order_id`.  
5. After payment, Razorpay calls your webhook `/webhooks/razorpay` with signature header. Verify signature with your webhook secret (HMAC SHA256).  
6. On verified payment, create a `Payment` record and update `Invoice.status = PAID`. Cancel pending reminders.

**Important**: Webhook must be idempotent — if the same webhook is received twice, ensure invoice is marked PAID only once.

---

## 11) Reminder engine — design & implementation
**Concept:** On invoice creation we schedule a set of reminders (e.g., 3 days before, day of due, 3 days after, 7 days after). Each reminder is a job in BullMQ that calls messaging providers.

**Components:**
- Scheduler (creates jobs)  
- Worker (processes jobs and uses WhatsApp / Email APIs)  
- Reminder table to persist attempts & status

**WhatsApp API notes:** For production use WhatsApp Cloud requires templates approved for business-initiated messages. For development use Twilio sandbox or test templates.

**Sample reminder flow:**
- Invoice created → scheduler computes dates → enqueue `SEND_REMINDER` jobs.
- Worker picks job → builds message using tenant template → calls WhatsApp API + Email API → on success, mark Reminder.sentAt & status SENT.
- If invoice paid before job runs → worker should verify invoice status and skip sending.

---

## 12) Jobs & worker patterns (BullMQ + Redis)
- Use BullMQ for reliable delayed jobs.  
- Run a separate worker process to keep UI responsive.  
- Use attempts and backoff for retries. Example: attempts=3, backoff=60000 (1 minute).

**Example job payload:**
```json
{
  "type": "SEND_REMINDER",
  "invoiceId": "inv_abc123",
  "method": "WHATSAPP"
}
```

---

## 13) Testing & monitoring — practical
- Unit test services (Jest).  
- Integration tests for endpoints using test DB.  
- E2E Playwright for create invoice → mock checkout → send webhook.  
- Setup Sentry for errors.  
- Monitor queue length and webhook failure rate.

---

## 14) Deployment & CI/CD (simple path)
- Frontend: Vercel (auto deploy on push).  
- Backend: Render or Railway (easy for solo dev) or Heroku.  
- Redis: Render Redis or Upstash.  
- DB: Supabase or DigitalOcean Managed Postgres.  
- CI: GitHub Actions — run tests and deploy.

---

## 15) Security checklist (must do)
- Validate inputs, sanitize strings.  
- Hash passwords (bcrypt or argon2).  
- Use HTTPS & HSTS.  
- Verify payment webhooks.  
- Do not store card information. Use provider vault.  
- Implement rate limiting and brute-force protections.  
- Use environment variables for secrets.

---

## 16) Implementation plan — 14-day MVP (actionable tasks)

**Day 0 — Setup**
- Repo, linter, .env.example, prisma init, DB set up.

**Day 1 — Auth & Tenant**
- Signup/login endpoints. Tenant creation on signup. JWT includes tenantId.

**Day 2 — Client model + endpoints**
- Create clients, list clients UI.

**Day 3 — Invoice model + upload**
- File upload to S3 (or local for dev). Create invoice endpoint & UI.

**Day 4 — Dashboard basics**
- List invoices, filters, simple stats.

**Day 5 — Razorpay order creation**
- Create order endpoint, test Checkout flow.

**Day 6 — Razorpay webhook**
- Implement webhook handler & idempotency; update invoice status.

**Day 7 — Reminder scheduler (basic)**
- On invoice create enqueue a single send job for due date.

**Day 8 — Worker & WhatsApp dev path**
- Build worker to send messages using Twilio sandbox or mock.

**Day 9 — Email via SendGrid**
- Integration + templates.

**Day 10 — Manual send UI**
- "Send reminder now" button & endpoint.

**Day 11 — Template settings**
- Tenant settings page for message templates.

**Day 12 — Cancel reminders on payment**
- Ensure worker checks invoice status before sending.

**Day 13 — Deploy backend & frontend (staging)**
- Setup production envs and test webhooks.

**Day 14 — Polish + demo video**
- README, demo GIF, one-pager, LinkedIn post draft.

---

## 17) Marketing & acquiring first users (practical scripts)
- Create 1–2 minute demo video showing upload → send → paid flow.  
- Post LinkedIn thread: "How I built PayPulse — 2 week journey" with screenshots.  
- DM 50 freelancers and agencies offering free 1-month trial; ask for feedback.  
- Run small ads in relevant Telegram / WhatsApp groups (regional freelancer groups).

**DM template (short):**
```
Hi {name}, I built PayPulse — it auto-reminds clients and adds a Razorpay payment link. Want to try free for 1 month? I’d love feedback.
```

---

## 18) AI roadmap — practical steps

**Step A — OCR invoice parsing (easy start)**
- Use Google Vision API or AWS Textract for OCR.
- Parse text to find amount and date with regex.
- Prefill the invoice form and show for user confirmation.

**Step B — LLM for message generation**
- Use simple prompt templates and call LLM to generate three tones: polite, direct, firm.
- Save generated text as template.

**Step C — Payment prediction model**
- Collect dataset: past invoices (days-to-pay, amount, client id, reminders sent)
- Train small model (XGBoost) offline to predict probability of late payment.
- Use score to increase reminder frequency for risky clients.

---

## 19) Premium features — how they help and how to implement

### Team & RBAC
- Adds value for agencies; implement `invite` flow, roles, permissions.

### Export & scheduled reports
- Implement background CSV exports and email them.

### Branded messages
- Allow paying tenants to customize footer and business name in messages.

### Auto reconciliation (advanced)
- Integrate bank statement parsing (requires account access or manual upload) — map payments to invoices using heuristics.

---

## 20) Teaching/advising notes — how to learn each topic fast
- **NestJS**: build small CRUD apps, follow official docs, study modules/controllers/providers pattern.  
- **Prisma**: practice schema changes + migrations; use `prisma studio` to inspect DB.  
- **Razorpay**: test in sandbox, practice webhook verification.  
- **BullMQ**: run simple worker sending console logs before integrating providers.  
- **WhatsApp API**: start with Twilio sandbox for development.

---

## 21) Checklists (copyable)

### Pre-launch checklist
- [ ] Signup + login OK  
- [ ] Invoice create + upload OK  
- [ ] Razorpay checkout + webhook OK  
- [ ] Reminder scheduling + worker OK  
- [ ] Cancel reminders on payment OK  
- [ ] Deploy staging + test webhooks  
- [ ] Demo video ready

### Security checklist
- [ ] HTTPS enabled  
- [ ] Webhook signatures verified  
- [ ] Passwords hashed  
- [ ] Rate limiting active

---

## 22) Appendix — useful code snippets & templates

### TenantGuard (NestJS) — concept
```ts
@Injectable()
export class TenantGuard implements CanActivate {
  canActivate(context: ExecutionContext) {
    const req = context.switchToHttp().getRequest();
    const user = req.user;
    if (!user || !user.tenantId) throw new UnauthorizedException();
    req.tenantId = user.tenantId;
    return true;
  }
}
```

### Razorpay create order (Node)
```ts
import Razorpay from "razorpay";
const razorpay = new Razorpay({ key_id: process.env.RZP_KEY, key_secret: process.env.RZP_SECRET });

async function createOrder(invoice) {
  const order = await razorpay.orders.create({
    amount: Math.round(invoice.amount * 100),
    currency: 'INR',
    receipt: invoice.invoiceNumber,
    notes: { invoiceId: invoice.id }
  });
  return order;
}
```

### Reminder WhatsApp template
```
Hi {clientName}, this is {businessName}. Invoice {invoiceNumber} for ₹{amount} was due on {dueDate}. Pay here: {paymentLink}
```

---

## Final words from your teacher/advisor
Start small. Ship fast. Perfection is the enemy of progress. Build the MVP that demonstrates value (invoices sent → payments received). Use the demo, screenshots, and a short video to get attention. Iterate with feedback. Focus on finishing — employers and founders value finished, deployed projects more than fancy incomplete features.

---

*This document was generated to be clear, actionable, and beginner-friendly. If you want, I can now:*
- Convert this into a downloadable **PDF** (ready to share).  
- Create a **Notion/Trello** formatted checklist.  
- Generate starter **NestJS repo skeleton** with auth + tenant guard.

Choose one or more by replying with numbers: `PDF`, `Notion`, `Repo` or `All`.


# PayPulse
